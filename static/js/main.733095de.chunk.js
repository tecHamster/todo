(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{28:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var c=n(17),o=(n(26),n(27),n(28),n(5)),a=n(6),r=n(2),i=n(3),s=n.n(i),l=n(1),u=n.n(l),d=n(36),f=n(35),j="https://mate.academy/students-api";function b(e){return new Promise((function(t){setTimeout(t,e)}))}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),b(100).then((function(){return fetch(j+e,c)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var p,h=function(e){return m(e)},O=function(e,t){return m(e,"POST",t)},v=function(e,t){return m(e,"PATCH",t)},x=function(e){return m(e,"DELETE")},g=function(e){return v("/todos/".concat(e.id),e)};!function(e){e.None="",e.Loading="Unable to load todos",e.EmptyTitle="Title should not be empty",e.Add="Unable to add a todo",e.Delete="Unable to delete a todo",e.Update="Unable to update a todo"}(p||(p={}));var y,N=n(4),T=n.n(N),C=n(10),k=function(){var e=Object(C.a)(T.a.mark((function e(t){var n;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=Object(C.a)(T.a.mark((function e(t){var n,c;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,c=t.name,e.abrupt("return",O("/users",{email:n,name:c}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=n(0),S=function(e){var t=e.onLogin,n=Object(l.useState)(""),c=Object(r.a)(n,2),o=c[0],a=c[1],i=Object(l.useState)(""),u=Object(r.a)(i,2),d=u[0],f=u[1],j=Object(l.useState)(!1),b=Object(r.a)(j,2),m=b[0],p=b[1],h=Object(l.useState)(!1),O=Object(r.a)(h,2),v=O[0],x=O[1],g=Object(l.useState)(""),y=Object(r.a)(g,2),N=y[0],S=y[1],E=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(l.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(c){}}),[t]);var A=function(){var e=Object(C.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(o);case 2:(t=e.sent)?E(t):p(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(C.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),S(""),x(!0),e.prev=3,!m){e.next=9;break}return e.next=7,_({name:d,email:o}).then(E);case 7:e.next=11;break;case 9:return e.next=11,A();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),S("Something went wrtong");case 16:return e.prev=16,x(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(w.jsxs)("form",{onSubmit:L,className:"box mt-5",children:[Object(w.jsx)("h1",{className:"title is-3",children:m?"You need to register":"Log in to open todos"}),Object(w.jsxs)("div",{className:"field",children:[Object(w.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(w.jsxs)("div",{className:s()("control has-icons-left",{"is-loading":v}),children:[Object(w.jsx)("input",{name:"emialToRegister",type:"email",id:"user-email",className:s()("input",{"is-danger":!m&&N}),placeholder:"Enter your email",disabled:v||m,value:o,required:!0,onChange:function(e){return a(e.target.value)}}),Object(w.jsx)("span",{className:"icon is-small is-left",children:Object(w.jsx)("i",{className:"fas fa-envelope"})})]}),!m&&N&&Object(w.jsx)("p",{className:"help is-danger",children:N})]}),m&&Object(w.jsxs)("div",{className:"field",children:[Object(w.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(w.jsxs)("div",{className:s()("control has-icons-left",{"is-loading":v}),children:[Object(w.jsx)("input",{name:"name",type:"text",id:"user-name",className:s()("input",{"is-danger":m&&N}),placeholder:"Enter your name",required:!0,minLength:4,disabled:v,value:d,onChange:function(e){return f(e.target.value)}}),Object(w.jsx)("span",{className:"icon is-small is-left",children:Object(w.jsx)("i",{className:"fas fa-user"})})]}),m&&N&&Object(w.jsx)("p",{className:"help is-danger",children:N})]}),Object(w.jsx)("div",{className:"field",children:Object(w.jsx)("button",{type:"submit",className:s()("button is-primary",{"is-loading":v}),children:m?"Register":"Login"})})]})},E={user:null,mainInput:null,todos:[],completedTodos:[],unCompletedTodos:[],errorText:p.None,loading:!1,idsToChange:[],setTodos:function(){},setLoading:function(){},setIdsToChange:function(){},showError:function(){},deleteTodo:function(){},updateTodo:function(){}},A=u.a.createContext(E),L=function(e){var t=e.children,n=Object(l.useState)(null),c=Object(r.a)(n,2),o=c[0],i=c[1],s=Object(l.useState)([]),u=Object(r.a)(s,2),d=u[0],f=u[1],j=Object(l.useState)(p.None),b=Object(r.a)(j,2),m=b[0],O=b[1],v=Object(l.useState)(!1),y=Object(r.a)(v,2),N=y[0],T=y[1],C=Object(l.useState)([]),k=Object(r.a)(C,2),_=k[0],E=k[1],L=Object(l.useRef)(null),I=Object(l.useMemo)((function(){return d.filter((function(e){return e.completed}))}),[d]),F=Object(l.useMemo)((function(){return d.filter((function(e){return!e.completed}))}),[d]),U=Object(l.useRef)(0);function B(e){window.clearTimeout(U.current),O(e),e&&(U.current=window.setTimeout((function(){O(p.None)}),3e3))}Object(l.useEffect)((function(){o&&h("/todos?userId=".concat(o.id)).then((function(e){return f(e)})).catch((function(){return B(p.Loading)}))}),[o]);var D={user:o,todos:d,mainInput:L,completedTodos:I,unCompletedTodos:F,errorText:m,loading:N,idsToChange:_,setTodos:f,setLoading:T,setIdsToChange:E,showError:B,deleteTodo:function(e){var t;E((function(t){return[].concat(Object(a.a)(t),[e])})),T(!0),(t=e,x("/todos/".concat(t))).then((function(){f((function(t){return t.filter((function(t){return t.id!==e}))}))})).catch((function(){return B(p.Delete)})).finally((function(){var t;T(!1),E((function(t){return t.filter((function(t){return t!==e}))})),null===L||void 0===L||null===(t=L.current)||void 0===t||t.focus()}))},updateTodo:function(e){T(!0),E((function(t){return[].concat(Object(a.a)(t),[e.id])})),g(e).then((function(){return f((function(t){var n=Object(a.a)(t),c=n.findIndex((function(t){return t.id===e.id}));return n.splice(c,1,e),n}))})).catch((function(){return B(p.Update)})).finally((function(){T(!1),E((function(t){return t.filter((function(t){return t!==e.id}))}))}))}};return o?Object(w.jsx)(A.Provider,{value:D,children:t}):Object(w.jsx)(S,{onLogin:i})},I=function(){var e=Object(l.useContext)(A),t=e.errorText,n=e.showError;return Object(w.jsxs)("div",{"data-cy":"ErrorNotification",className:s()("notification","is-danger","s-light","has-text-weight-normal",{hidden:!t}),children:[Object(w.jsx)("button",{"aria-label":"Hide notification","data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return n(p.None)}}),t]})};!function(e){e.All="All",e.Active="Active",e.Completed="Completed"}(y||(y={}));var F=function(e){var t=e.filterBy,n=e.setFilterBy,c=Object(l.useContext)(A),o=c.deleteTodo,a=c.todos,r=c.unCompletedTodos,i=c.completedTodos,u=r.length,d=function(e){return function(t){t.preventDefault(),n(e)}};return Object(w.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(w.jsx)("span",{className:"todo-count","data-cy":"TodosCounter",children:"".concat(u," items left")}),Object(w.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(w.jsx)("a",{href:"#/",className:s()("filter__link",{selected:t===y.All}),"data-cy":"FilterLinkAll",onClick:d(y.All),children:"All"}),Object(w.jsx)("a",{href:"#/active",className:s()("filter__link",{selected:t===y.Active}),"data-cy":"FilterLinkActive",onClick:d(y.Active),children:"Active"}),Object(w.jsx)("a",{href:"#/completed",className:s()("filter__link",{selected:t===y.Completed}),"data-cy":"FilterLinkCompleted",onClick:d(y.Completed),children:"Completed"})]}),Object(w.jsx)("button",{disabled:0===i.length,type:"button",className:"todoapp__clear-completed","data-cy":"ClearCompletedButton",onClick:function(){a.filter((function(e){return e.completed})).forEach((function(e){var t=e.id;return o(t)}))},children:"Clear completed"})]})},U=function(e){var t=e.todo,n=e.isUpdating,c=Object(l.useContext)(A),i=c.deleteTodo,u=c.updateTodo,d=c.setLoading,f=c.setIdsToChange,j=c.setTodos,b=c.showError,m=Object(l.useState)(!1),h=Object(r.a)(m,2),O=h[0],v=h[1],x=Object(l.useState)(t.title),y=Object(r.a)(x,2),N=y[0],T=y[1],C=Object(l.useRef)(null);Object(l.useEffect)((function(){setTimeout((function(){var e;null===(e=C.current)||void 0===e||e.focus(),T(t.title)}),0)}),[O,t.title]);function k(){var e;v(!0),null===(e=C.current)||void 0===e||e.focus()}function _(){if(N!==t.title&&!n){if(N.trim()!==t.title&&N.trim()){var e=Object(o.a)(Object(o.a)({},t),{},{title:N.trim()});return d(!0),f((function(t){return[].concat(Object(a.a)(t),[e.id])})),void g(e).then((function(){return j((function(t){var n,c=Object(a.a)(t),o=c.findIndex((function(t){return t.id===e.id}));return c.splice(o,1,e),null===(n=C.current)||void 0===n||n.blur(),c}))})).catch((function(){b(p.Update),k()})).finally((function(){d(!1),f((function(t){return t.filter((function(t){return t!==e.id}))}))}))}var c;if(0===N.trim().length)i(t.id),null===(c=C.current)||void 0===c||c.blur()}}return Object(w.jsxs)("div",{"data-cy":"Todo",className:s()("todo",{completed:t.completed}),children:[Object(w.jsx)("label",{className:"todo__status-label",id:t.id.toString(),children:Object(w.jsx)("input",{"aria-label":"Change todo title","aria-labelledby":t.id.toString(),name:t.id.toString(),"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",checked:t.completed,onChange:function(){var e=Object(o.a)(Object(o.a)({},t),{},{completed:!t.completed});u(e)}})}),O?Object(w.jsx)("input",{name:"mainInput","data-cy":"TodoTitleField",type:"text",className:"todo__title-field",ref:C,value:N,onChange:function(e){return T(e.target.value)},onBlur:function(){v(!1),_()},onKeyUp:function(e){"Escape"!==e.key?"Enter"===e.key&&(_(),v(!1)):v(!1)}}):Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:k,children:t.title}),Object(w.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDelete",onClick:function(){return i(t.id)},children:"\xd7"})]}),Object(w.jsxs)("div",{"data-cy":"TodoLoader",className:s()("modal","overlay",{"is-active":n}),children:[Object(w.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(w.jsx)("div",{className:"loader"})]})]})},B=function(){var e,t=Object(l.useContext)(A),n=t.user,c=t.todos,i=t.mainInput,u=t.completedTodos,j=t.unCompletedTodos,b=t.loading,m=t.setTodos,h=t.setLoading,v=t.showError,x=t.updateTodo,g=t.idsToChange,N=Object(l.useState)(""),T=Object(r.a)(N,2),C=T[0],k=T[1],_=Object(l.useState)(null),S=Object(r.a)(_,2),E=S[0],L=S[1],B=Object(l.useState)(y.All),D=Object(r.a)(B,2),R=D[0],J=D[1];switch(Object(l.useEffect)((function(){var e;null===i||void 0===i||null===(e=i.current)||void 0===e||e.focus()}),[i,c]),R){case y.All:default:e=c;break;case y.Completed:e=u;break;case y.Active:e=j}return Object(w.jsxs)("div",{className:"todoapp",children:[Object(w.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(w.jsxs)("div",{className:"todoapp__content",children:[Object(w.jsxs)("header",{className:"todoapp__header",children:[c.length>0&&Object(w.jsx)("button",{type:"button","aria-label":"Toggle all todos",className:s()("todoapp__toggle-all",{active:u.length===c.length}),"data-cy":"ToggleAllButton",onClick:function(){j.length>0?j.forEach((function(e){var t=Object(o.a)(Object(o.a)({},e),{},{completed:!e.completed});x(t)})):u.forEach((function(e){var t=Object(o.a)(Object(o.a)({},e),{},{completed:!e.completed});x(t)}))}}),Object(w.jsx)("form",{onSubmit:function(e){if(e.preventDefault(),0!==C.trim().length){if(n){h(!0),k((function(e){return e.trim()}));var t={title:C.trim(),completed:!1,id:0,userId:n.id};L(t),function(e){return O("/todos",e)}(t).then((function(e){k(""),m((function(t){return[].concat(Object(a.a)(t),[e])})),L(null)})).catch((function(){v(p.Add),L(null)})).finally((function(){h(!1),setTimeout((function(){var e;null===i||void 0===i||null===(e=i.current)||void 0===e||e.focus()}),0)}))}}else v(p.EmptyTitle)},children:Object(w.jsx)("input",{name:"mainInput","data-cy":"NewTodoField",type:"text",className:"todoapp__new-todo",placeholder:"What needs to be done?",disabled:b,ref:i,value:C,onChange:function(e){k(e.target.value),v(p.None)}})})]}),Object(w.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:Object(w.jsxs)(d.a,{children:[e.map((function(e){return Object(w.jsx)(f.a,{timeout:300,classNames:"item",children:Object(w.jsx)(U,{todo:e,isUpdating:g.includes(e.id)},e.id)},e.id)})),E&&Object(w.jsx)(f.a,{timeout:300,classNames:"temp-item",children:Object(w.jsx)(U,{todo:E,isUpdating:!0})},0)]})}),!!c.length&&Object(w.jsx)(F,{filterBy:R,setFilterBy:J})]}),Object(w.jsx)(I,{})]})};Object(c.createRoot)(document.getElementById("root")).render(Object(w.jsx)(L,{children:Object(w.jsx)(B,{})}))}},[[33,1,2]]]);
//# sourceMappingURL=main.733095de.chunk.js.map